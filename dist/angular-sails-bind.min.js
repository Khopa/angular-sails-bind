/*! angular-sails-bind - v1.0.2 - 2014-06-18
* https://github.com/diegopamio/angular-sails-bind
* Copyright (c) 2014 Diego Pamio; Licensed MIT */
var app=angular.module("ngSailsBind",[]);app.factory("$sailsBind",["$q",function(a){"use strict";var b=function(b,e,f){var g=new a.defer,h=d("/"+b,f);return h.then(function(a){e[b+"s"]=a,c(a,e,b),g.resolve()}),io.socket.on(b,function(a){var c=e[b+"s"],d={created:function(){e[b+"s"].push(a.data)},updated:function(){var c=e[b+"s"].find(function(b){return parseInt(a.id,10)===parseInt(b.id,10)});angular.extend(c,a.data)},destroyed:function(){var d=e[b+"s"].find(function(b){return parseInt(b.id,10)===parseInt(a.id,10)});d&&c.splice(c.indexOf(d),1)}};d[a.verb]()}),e.$watchCollection(b+"s",function(a,f){var g,h;a=a||[],f=f||[],g=a.diff(f),h=f.diff(a),h.forEach(function(a){d("/"+b+"?id="+a.id).then(function(c){c&&!c.error&&io.socket.delete("/"+b+"/destroy/"+a.id)})}),g.forEach(function(a){a.id||io.socket.put("/"+b+"/create/",a,function(c){d("/"+b+"/"+c.id).then(function(b){angular.extend(a,b)})}),c(g,e,b)})}),g.promise},c=function(a,b,c){a.forEach(function(a){b.$watchCollection(c+"s["+b[c+"s"].indexOf(a)+"]",function(a,b){b&&a&&(angular.equals(b,a)||parseInt(b.id,10)!==parseInt(a.id,10)||b.updatedAt!==a.updatedAt||io.socket.post("/"+c+"/update/"+b.id,angular.copy(a)))})})},d=function(b,c){var d=new a.defer;return c=c||{},io.socket.request(b,c,function(a){$rootScope.$apply(d.resolve(a))}),d.promise};return{bind:b}}]),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{enumerable:!1,configurable:!0,writable:!0,value:function(a){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;d>f;f++)if(f in c&&(b=c[f],a.call(e,b,f,c)))return b;return void 0}}),Array.prototype.diff||(Array.prototype.diff=function(a){return this.filter(function(b){return a.indexOf(b)<0})});